# 主题：Hystrix熔断机制的使用  和  内部讲解

**前提：已经了解Eureka、Ribbon、Feign 等相关组件**

问题：所有使用 @HystrixCommand 注解修饰的方法，如果指定线程池名称，都是使用的同一个线程池，默认有10个线程，当线程数量满了，并且此时服务器出现问题导致线程阻塞，会怎样？会因没有线程去执行而导致请求失败吗？
不会，但是会进入等待队列等待空闲线程 。

如何解决呢？增加线程持的最大并发数，或者开辟新的线程池。

Hystrix 把这种模式称为： 

###  舱壁模式(BulkHead)

**ThreadPoolKey**：线程池名称(定义进入当前方法的线程池的名称)

| coreSize     | 当前线程池的最大线程数默认10                               |
| ------------ | ---------------------------------------------------------- |
| maxQueueSize | 当前线程池的线程都被占用，允许请求线程排队的最大数量默认10 |



### Hystrix 工作流程

1、当调用出现错误时，开启一个时间窗 （默认10秒）
2、在这个时间窗内，统计调用次数是否达到最小请求数？
	  如果没有达到，则重置统计信息，回到第 1 步。
	  如果达到，则统计 失败的请求数 与 所有请求数的占比，是否达到阈值？
			  达到则跳闸，不再请求对应服务。
			  未达到则 重置统计信息，回到第 1 步。

3、如果跳闸，则会开启一个活动窗口（默认5s），每隔5s，Hystrix 会让一个请求通过，看是否请求成功？
	  如果成功，重置断路器，回到第一步
	  如果失败，重置活动窗口，回到第三步。

**定义断路器的行为**

1、出现错误时  时间窗的长度。
2、最小请求数。
3、错误请求的百分比。
4、跳闸后，活动窗口的长度。

